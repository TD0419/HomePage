<!DOCTYPE html>
<html>
<head>
<link rel ="stylesheet" href="1_DBDesign.css">
<title>【第一回】DB構成を決めよう！</title>
</head>
<body>
<a href= "../0_Contents/0_Contents.html"><目次></a>

<h1>【第一回】DB構成を決めよう！</h1>
<h2>・要件定義</h2>
<p>
まずは、実装を始める前に仕様を書き出していきましょう。<br>
何を作らないといけないかを把握するのは大事です。<br>
<br>
・ガチャを引くとキャラクターが手に入る<br>
・ガチャは一種類だけ<br>
・ガチャは単発のみ引ける<br>
・ガチャで手に入るレアリティは「☆」「☆☆」「☆☆☆」の三種類(☆が最小、☆☆☆が最大)<br>
・ガチャで手に入る確率はDBで設定したとおりにする<br>
・ガチャ結果で「レアリティ」、「名称」を表示させる。<br>
<br>
・・・とりあえずこんなものでしょうか。<br>
もっと色々と作りたいとは思いますが、やることが多いと実装が億劫になってしまいます。<br>
なので、これ位にして全て実装後に必要であれば、追加しましょう。<br>
<br>
</p>

<h2>・DB設計</h2>
<p>
さて、実装する内容が決まりましたので、DBの構成について考えていきましょう。<br>
とにかく必要になりそうなものをどんどん作ります。<br>
<br>
m_gacha
</p>

<table border="1">
    <tr>
      <th>No.</th>
      <th>PK</th>
      <th>FK</th>
      <th>カラム名</th>
      <th>データ型</th>
      <th>NotNull</th>
      <th>デフォルト</th>
      <th>備考</th>
    </tr>
    <tr>
      <td>1</td>
      <td>〇</td>
      <td></td>
      <td>id</td>
      <td>INTEGER</td>
      <td>NOTNULL</td>
      <td></td>
      <td>ガチャID</td>
    </tr>
    <tr>
        <td>2</td>
        <td></td>
        <td></td>
        <td>title</td>
        <td>INTEGER</td>
        <td>NOTNULL</td>
        <td></td>
        <td>ガチャタイトル</td>
    </tr>
    <tr>
        <td>3</td>
        <td></td>
        <td></td>
        <td>gacha_group</td>
        <td>VARCHAR(255)</td>
        <td></td>
        <td></td>
        <td>ガチャ排出グループ</td>
    </tr>
    <tr>
        <td>4</td>
        <td></td>
        <td></td>
        <td>cost</td>
        <td>INTEGER</td>
        <td>NOTNULL</td>
        <td></td>
        <td>ガチャに必要なアイテム数</td>
    </tr>
  </table>

<p>
こちらはガチャのマスターテーブルです。<br>
ガチャの種類を設定することができ、ピックアップガチャや有償ガチャなどの<br>
複数のガチャを扱えるようになります。<br>
<br>
m_character<br>
</p>

<table border="1">
    <tr>
      <th>No.</th>
      <th>PK</th>
      <th>FK</th>
      <th>カラム名</th>
      <th>データ型</th>
      <th>NotNull</th>
      <th>デフォルト</th>
      <th>備考</th>
    </tr>
    <tr>
      <td>1</td>
      <td>〇</td>
      <td></td>
      <td>id</td>
      <td>INTEGER</td>
      <td>NOTNULL</td>
      <td></td>
      <td>キャラクターID</td>
    </tr>
    <tr>
        <td>2</td>
        <td></td>
        <td></td>
        <td>name</td>
        <td>VARCHAR(255)</td>
        <td></td>
        <td></td>
        <td>キャラクター名</td>
    </tr>
  </table>

  <p>
    こちらはキャラクターのマスタテーブルです。<br>
    ゲームで登場するキャラクターをここに登録します。<br>
    今回キャラクターを排出しますが、このマスターテーブルはあくまでキャラクター情報です。<br>
    ここから排出するキャラクターは決まりません。<br>
    詳しくは後程記載します。<br>
    <br>
    m_rerity
</p>

<table border="1">
    <tr>
      <th>No.</th>
      <th>PK</th>
      <th>FK</th>
      <th>カラム名</th>
      <th>データ型</th>
      <th>NotNull</th>
      <th>デフォルト</th>
      <th>備考</th>
    </tr>
    <tr>
      <td>1</td>
      <td>〇</td>
      <td></td>
      <td>id</td>
      <td>INTEGER</td>
      <td>NOTNULL</td>
      <td></td>
      <td>レアリティID</td>
    </tr>
    <tr>
        <td>2</td>
        <td></td>
        <td></td>
        <td>name</td>
        <td>VARCHAR(255)</td>
        <td></td>
        <td></td>
        <td>レアリティ名(☆など)</td>
    </tr>
  </table>
<p>
    こちらはレアレティのマスタテーブルです。<br>
    idが1なら「☆」、idが3なら「☆☆☆」という具合ですね。<br>
    ガチャだけではなく、ゲームでも使用できるように汎用性があるようにしましょう。<br>
    マスタとして持っておくことによって、新しいレアリティが必要になってもすぐに追加できます。<br>
    <br>
    m_item
</p>

<table border="1">
    <tr>
      <th>No.</th>
      <th>PK</th>
      <th>FK</th>
      <th>カラム名</th>
      <th>データ型</th>
      <th>NotNull</th>
      <th>デフォルト</th>
      <th>備考</th>
    </tr>
    <tr>
      <td>1</td>
      <td>〇</td>
      <td></td>
      <td>id</td>
      <td>INTEGER</td>
      <td>NOTNULL</td>
      <td></td>
      <td>アイテムID</td>
    </tr>
    <tr>
        <td>2</td>
        <td></td>
        <td></td>
        <td>type</td>
        <td>VARCHAR(255)</td>
        <td>NOTNULL</td>
        <td></td>
        <td>アイテムタイプ(キャラクターは1など)</td>
    </tr>
    <tr>
        <td>3</td>
        <td></td>
        <td></td>
        <td>contents_id</td>
        <td>INTEGER</td>
        <td>NOTNULL</td>
        <td></td>
        <td>コンテンツID(キャラクターIDなど)</td>
    </tr>
  </table>
  <p>
    こちらはアイテムのマスタテーブルです。<br>
    ゲームでは様々な種類のアイテムがあります。<br>
    ですので、種類分けができるようにしておきましょう。<br>
    今回では所持しているキャラクターもアイテムとして持たせます。<br>
    アイテムにキャラクターIDを持たせて、キャラクター情報を引っ張ってこれるようにしておきましょう。<br>
    正直コンテンツIDはキャラクターIDと関連を持たせるために無理やり入れた感があるので、<br>
    将来的にDB構成が変わる可能性があります。<br>
    <br>
   m_item_type

  </p>
  <table border="1">
    <tr>
      <th>No.</th>
      <th>PK</th>
      <th>FK</th>
      <th>カラム名</th>
      <th>データ型</th>
      <th>NotNull</th>
      <th>デフォルト</th>
      <th>備考</th>
    </tr>
    <tr>
      <td>1</td>
      <td>〇</td>
      <td></td>
      <td>id</td>
      <td>INTEGER</td>
      <td>NOTNULL</td>
      <td></td>
      <td>アイテムタイプID</td>
    </tr>
    <tr>
        <td>2</td>
        <td></td>
        <td></td>
        <td>name</td>
        <td>VARCHAR(255)</td>
        <td></td>
        <td></td>
        <td>名前(キャラクターなど)</td>
    </tr>
  </table>

  <p>
    <br>
    m_gacha_item
</p>
<table border="1">
    <tr>
        <th>No.</th>
        <th>PK</th>
        <th>FK</th>
        <th>カラム名</th>
        <th>データ型</th>
        <th>NotNull</th>
        <th>デフォルト</th>
        <th>備考</th>
      </tr>
      <tr>
        <td>1</td>
        <td>〇</td>
        <td></td>
        <td>id</td>
        <td>INTEGER</td>
        <td>NOTNULL</td>
        <td></td>
        <td>ガチャアイテムID</td>
      </tr>
      <tr>
          <td>2</td>
          <td></td>
          <td></td>
          <td>rate</td>
          <td>INTEGER</td>
          <td>NOTNULL</td>
          <td></td>
          <td>確率(0.1%なら0.1)</td>
      </tr>
      <tr>
          <td>3</td>
          <td></td>
          <td></td>
          <td>item_id</td>
          <td>INTEGER</td>
          <td>NOTNULL</td>
          <td></td>
          <td>アイテムID</td>
      </tr>
      <tr>
        <td>4</td>
        <td></td>
        <td></td>
        <td>rerity_id</td>
        <td>INTEGER</td>
        <td>NOTNULL</td>
        <td></td>
        <td>レアリティID</td>
    </tr>
    </table>
    <p>
    遂に出てきました、ガチャアイテムのマスタテーブルです。<br>
    ここで排出の確率を設定できます。<br>
    アイテムIDで先ほど作ったアイテムマスタテーブルからアイテム情報を引っ張ってきましょう。<br>
    <br>
    
    一通りガチャに必要なマスタテーブルを作成しました。
    まだまだ手を入れたい箇所もあるとは思いますが、実装の方にも着手していきましょう。
    実装することによって見えてくることもあります。

    次回はPostgreSQLでDBを実装していきましょう！

    【第二回】DBを実装しよう！
    </p>

</body>
</html>
